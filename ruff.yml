include:
    -   remote: 'https://lab.frogg.it/swepy/cicd-templates/venv/-/raw/venv@1.0.0/venv.yml'

venv:
    rules:
        -   when: never

ruff_venv:
    extends: venv
    stage: build
    variables:
        PYTHON_SETUP: 'pip install ruff'
        VENV_ARTIFACT_NAME: 'ruff_venv'
    rules:
        -   when: null

ruff:
    variables:
        IMAGE_NAME: 'python'
        IMAGE_TAG: 'latest'
        IMAGE: '$IMAGE_NAME:$IMAGE_TAG'
        PROJECT_PATH: '.'
        RUFF_CHECK: 'ruff check'
        RUFF_FORMAT: 'ruff format --check'
    image: $IMAGE
    stage: test
    before_script:
        - source venv/bin/activate
        - echo $PROJECT_PATH  # Debug
        - cd $PROJECT_PATH
        - pwd  # Debug
    script:
        - echo $RUFF_CHECK  # Debug
        - $RUFF_CHECK
        - echo $RUFF_FORMAT  # Debug
        - $RUFF_FORMAT
    needs:
        -   job: ruff_venv
            artifacts: true
